<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home Planner App</title>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-firestore.js"></script>
    <style>
      body {
        font-family: "Arial", sans-serif;
        background-color: #f4f7f6;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      .container {
        background-color: white;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
        border-radius: 8px;
        width: 100%;
        max-width: 400px;
      }
      h1 {
        color: #333;
        text-align: center;
      }
      input,
      select,
      button,
      label {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 4px;
        border: 1px solid #ddd;
        box-sizing: border-box;
      }
      button {
        background-color: #6a1b9a;
        color: white;
        border: none;
        cursor: pointer;
      }
      button:hover {
        background-color: #7b1fa2;
      }
      .task {
        background-color: #e9ecef;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 10px;
      }
      .task strong {
        color: #333;
      }
      #attendeesCheckboxes label,
      #cycleAttendeesLabel {
        display: block;
        margin-bottom: 5px;
      }
      #customFrequency,
      #nrOfDays {
        display: none;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Home Planner App</h1>

      <div id="loginSection">
        <input type="text" id="usernameInput" placeholder="Username" />
        <input type="password" id="passwordInput" placeholder="Password" />
        <button onclick="login()">Login</button>
      </div>

      <div id="taskSection" style="display: none">
        <input type="text" id="taskInput" placeholder="Enter a task" />

        <div id="dateFields">
          <input
            type="date"
            id="startDate"
            placeholder="Start Date"
            onchange="toggleFrequencyOptions()"
          />
          <select id="frequencySelect" onchange="toggleFrequencyOptions()">
            <option value="singleTime">Single Time</option>
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="custom">Every few days</option>
          </select>
          <input
            type="number"
            id="nrOfDays"
            placeholder="Nr of Days (for custom frequency)"
            min="1"
          />
        </div>

        <div id="attendeesCheckboxes">
          <label><input type="checkbox" value="marco" /> Marco</label>
          <label><input type="checkbox" value="radu" /> Radu</label>
          <label><input type="checkbox" value="sepi" /> Sepi</label>
        </div>
        <label id="cycleAttendeesLabel">
          <input type="checkbox" id="cycleAttendees" /> Cycle attendees
        </label>
        <button onclick="addTaskFromForm()">Add Task</button>
        <div id="tasks"></div>
      </div>
    </div>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyAke-PNsJO4P0HMGZlVamz3DCG_xo40W2A",

        authDomain: "home-server-a5690.firebaseapp.com",

        projectId: "home-server-a5690",

        storageBucket: "home-server-a5690.appspot.com",

        messagingSenderId: "497296621772",

        appId: "1:497296621772:web:b17121bfe91c027d4f4269",
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      let users = {
        marco: "randPass1",
        radu: "randPass2",
        sepi: "randPass3",
      };
      let currentUser = null;

      function login() {
        const username = document.getElementById("usernameInput").value;
        const password = document.getElementById("passwordInput").value;
        if (users[username] && users[username] === password) {
          currentUser = username;
          document.getElementById("loginSection").style.display = "none";
          document.getElementById("taskSection").style.display = "block";
          fetchTasks();
        } else {
          alert("Invalid username or password");
        }
      }

      function fetchTasks() {
        db.collection("tasks")
          .where("user", "==", currentUser)
          .get()
          .then((querySnapshot) => {
            const tasksContainer = document.getElementById("tasks");
            tasksContainer.innerHTML = "";
            querySnapshot.forEach((doc) => {
              const task = doc.data();
              const taskDiv = document.createElement("div");
              taskDiv.className = "task";
              taskDiv.innerHTML = `<strong>Task:</strong> ${task.name}<br>
                                 <strong>Start Date:</strong> ${task.startDate}<br>
                                 <strong>Frequency:</strong> ${task.frequency}`;
              tasksContainer.appendChild(taskDiv);
            });
          })
          .catch((error) => {
            console.error("Error fetching tasks: ", error);
          });
      }

      function addTaskFromForm() {
        const taskName = document.getElementById("taskInput").value;
        const startDate = document.getElementById("startDate").value;
        const frequency = document.getElementById("frequencySelect").value;
        const nrOfDays =
          frequency === "custom"
            ? document.getElementById("nrOfDays").value
            : "";
        const attendeesCheckboxes = document.querySelectorAll(
          "#attendeesCheckboxes input:checked"
        );
        const attendees = Array.from(attendeesCheckboxes).map((cb) => cb.value);
        const cycleAttendees =
          document.getElementById("cycleAttendees").checked;

        if (!taskName || (frequency !== "singleTime" && !startDate)) {
          alert("Please fill in all required fields.");
          return;
        }

        const newTask = {
          name: taskName,
          startDate: startDate,
          frequency: frequency,
          nrOfDays: nrOfDays,
          attendees: attendees,
          cycleAttendees: cycleAttendees,
          user: currentUser,
        };

        db.collection("tasks")
          .add(newTask)
          .then((docRef) => {
            console.log("Task added with ID: ", docRef.id);
            fetchTasks();// Refresh the list of tasks 
            clearForm();
          })
          .catch((error) => {
            console.error("Error adding task: ", error);
          });
      }

      function toggleFrequencyOptions() {
        const frequencySelect = document.getElementById("frequencySelect");
        const nrOfDaysInput = document.getElementById("nrOfDays");
        nrOfDaysInput.style.display =
          frequencySelect.value === "custom" ? "block" : "none";
      }

      function clearForm() {
        document.getElementById("taskInput").value = "";
        document.getElementById("startDate").value = "";
        document.getElementById("frequencySelect").selectedIndex = 0;
        document.getElementById("nrOfDays").value = "";
        document
          .querySelectorAll("#attendeesCheckboxes input:checked")
          .forEach((cb) => (cb.checked = false));
        document.getElementById("cycleAttendees").checked = false;
      }
    </script>
  </body>
</html>
